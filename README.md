# Хакатон ARCHI.Tech от ВТБ

## Состав решения

- функциональная структура
- архитектура данных
- прикладная архитектура
- API модулей системы
- архитектура развёртывания

## [Демо-задача](./demo.pdf)

## [Разминочная задача](./warmup.pdf)

<details>
<summary><b>Условия</b></summary>
<br>

Имеется web-приложение интернет-магазина, реализованное с использованием популярных технологий (например, NodeJS+React).

Руководитель проекта поручил повысить позиции сайта в результирующих выборках поисковых сервисов. Для этого необходимо предоставить возможность сбора и анализа статистики посещения web-страниц приложения.

Спроектируйте архитектуру и структуру приложения с учетом нового функционала по сбору и отображению статистики посещения web-страниц за определенный период времени.

Дополнительно предусмотрите возможность горизонтального масштабирования приложения при повышении числа запросов, равномерного распределения потоков запросов между обработчиками, а также горячего резервирования компонентов приложения для обеспечения отказоустойчивой работы.

Прикрепите файл в формате .pptx или .pdf ([шаблон презентации](./template.pptx)).

**Технологический стек**

<ins>Отмечены</ins> предпочтительные варианты.

Сетевые шлюзы
- <ins>HAProxy</ins>
- WAF
- Nginx

Виртуализация
- VMWare
- Proxmox
- <ins>Docker</ins>

Серверная часть
- <ins>NodeJS</ins>
- Flask

СУБД
- <ins>PostgreSQL</ins>

Мониторинг
- <ins>ELK + Heartbeat</ins>
- Prometheus + Grafana

Клиентская часть
- <ins>React</ins>
- Vue

</details>

### Технологический стек

<details>
<summary>По технологиям</summary>
<br>

IDM
- Keycloak

Сетевые шлюзы
- Nginx
- HAProxy
- Microsoft IIS

Виртуализация
- Openshift
- VMWare vSphere
- K8s

СУБД
- PostgreSQL
- Oracle DB
- MS SQL
- Redis
- Tarantool

Шины сообщений
- Active MQ
- Apache Kafka
- IBM MQ
- Rabbit MQ

Обработчики сообщений
- Debezium
- Apache Flink
- Kafka Streams
- Oracle GoldenGate

Поисковые системы
- Elasticsearch
- Opensearch

Мониторинг
- Kibana
- Grafana
- Prometheus

</details>

## Простая задача: Статистика посещений сайта

<details>
<summary><b>Дано</b></summary>
<br>

Для существующего web-приложения необходимо спроектировать и внедрить систему сбора и анализа действий пользователей на сайте. Под действиями пользователей подразумеваются переходы на web-страницы.

Сайт посещает до 50 000 пользователей в сутки. Пиковая нагрузка может достигать 100 одновременных пользовательских сессий.

</details>

<details>
<summary><b>Что нужно сделать</b></summary>
<br>

Система должна предоставлять сотрудникам организации, владеющей web-приложением: возможность визуализации действий пользователей за указанный период, подсчитывать статистику посещений. При этом система не должна пропускать события при пиковых нагрузках или сбоях в web-приложении.

Предусмотрите ограничение доступа к статистике и средствам визуализации.

</details>

<details>
<summary><b>Оценка сложности решения</b></summary>
<br>
  
Пиковая нагрузка может достигать 100 одновременных пользовательских сессий.
Сайт посещает до 50 000 пользователей в сутки.

Современные web-приложения рассчитаны на десятки тысяч активных пользователей.
⇒ Задача состоит только в добавлении системы сбора, сохранения и отображения статистики.

Система не должна пропускать события при пиковых нагрузках или сбоях в web-приложении.
⇒ Сбор статистики должен разделять запросы пользователей и ответы приложения.

Такой сбор возможно выполнять комбинацией из HAProxy и Logstash Persistent Queues.
Кластер LPQ, в свою очередь, должен поставлять сообщения о запросах и ответах HAProxy
с указанием метода, пути к ресурсу HTTP, заголовков, размеров сообщений, времени генерации, ID клиента и прочих параметрах в кластер Elasticsearch.

Отображение статистики возможно посредством Kibana, настроенной в отдельном от web-приложения окружении, с аутентификацией от внешнего провайдера SSO.

</details>

## [Средняя задача: Электронная очередь](./queue.pdf)

<details>
<summary><b>Дано</b></summary>
<br>

Для крупного банка с отделениями по всей России необходима система электронной очереди.

Система включает в себя клиентские терминалы, рабочие места сотрудников отделений, информационное табло, место администратора. С помощью клиентского терминала можно подать запрос на постановку в очередь для обслуживания в зависимости от типа операции.

Рабочие места сотрудников позволяют вызвать очередного клиента из определенной очереди на обработку.

Сотрудник должен иметь возможность настраивать часы приема на рабочем месте.

Информационное табло отображает текущее заполнение очереди и номер рабочего места обработки очередной заявки.

Место администратора позволяет настраивать и администрировать систему, задавать количество рабочих мест, типы очередей, время работы сотрудников.

</details>

<details>
<summary><b>Что нужно сделать</b></summary>
<br>

Предложить архитектуру системы «Электронной очереди» для отделений Банка.

Предусмотреть возможность восстановления содержимого очередей при отключении питания в отделении, а также автоматического подключения к обработке заявок сотрудников, зарегистрировавшихся в системе.

</details>

<details>
<summary><b>Причины выбора задачи для решения</b></summary>
<br>

1. Простая задача Статистика посещений сайта содержит мало функциональных требований, понятных на уровне бизнеса, в основном требования технические.

Численные оценки, указанные в условии простой задачи, на несколько порядков меньше, чем у интересных с точки зрения проработки прикладной архитектуры задач. 

2. Сложная задача Система приема заказов содержит очень много функциональных требований на уровне бизнеса, что приводит к риску не успеть описать решение за сутки.

Численные оценки, указанные в условии сложной задачи, на несколько порядков меньше, чем у интересных с точки зрения проработки прикладной архитектуры задач. 

3. Средняя задача Электронная очередь содержит достаточно сведений для описания use-case’ов, архитектуры данных и функциональных требований.

В условии задачи не указаны численные оценки, но характер условий говорит о возможности сосредоточиться не на высоконагруженной архитектуре, а на [оригинальных подходах к решению](./queue.pdf).

</details>

## Сложная задача: Система приема заказов

<details>
<summary><b>Дано</b></summary>
<br>

Быстро развивающаяся сеть ресторанов планирует разработать единую систему приема заказов.

Система включает в себя web- и мобильное приложения для гостей ресторана, рабочие места официанта, администратора ресторана, бухгалтера, администратора системы.

Web- и мобильное приложения для гостей имеют функциональность по формированию заказа в зале или для доставки, оплате и просмотру статуса своего заказа, обращению в службу поддержки.

Рабочее место позволяет обрабатывать заказы, закрепленные за конкретным официантом. Он может менять состав и статус заказа, отвечать на вопросы гостя.

Рабочее место администратора позволяет настраивать столики ресторана, формировать и распечатывать индивидуальные QR-коды для каждого столика, формировать смены официантов и закрепление столов за ними. Администратор видит все заказы своего ресторана, а также все обращения в службу поддержки, адресованные указанному ресторану или в разделе «Общие вопросы».

Рабочее место бухгалтера позволяет осуществлять просмотр заказов во всех ресторанах за любой период времени, формировать выгрузку для отправки в налоговую службу.

Среднее число заказов в сутки в ресторанах достигает 20 000 и в дальнейшем будет расти. В каждом ресторане может быть до 10 официантов. Планируется подключить к системе до 100 ресторанов.

</details>

<details>
<summary><b>Что нужно сделать</b></summary>
<br>

Спроектировать «Систему приема заказов» для сети ресторанов.

Разработку системы будут осуществлять несколько независимых команд, каждая из которых отвечает за свою часть функциональности.

</details>

<details>
<summary><b>Оценка сложности решения</b></summary>
<br>

Планируется подключить к системе до 100 ресторанов. В каждом может быть до 10 официантов.
Среднее число заказов в сутки в ресторанах достигает 20 000 и в дальнейшем будет расти.
⇒ 1000 официантов, 20 заказов на официанта в сутки, ~ 3 заказа в час, ~ 8 RPS на запись.

Современные web-приложения рассчитаны на десятки тысяч активных пользователей и RPS.
⇒ Система может быть реализована как модульное приложение на одном web-сервере.

Модель данных предполагает наличие отношений между набором сущностей:
ресторан, клиент, столик, официант, блюдо, заказ, счет и т.д.

Отказоустойчивость такой системы может быть достигнута за счет синхронной репликации БД.
Экономически эффективный вариант отказоустойчивой реляционной СУБД – PostgreSQL.

Формирование отчётности по любому периоду работы возможно на асинхронной реплике.

</details>
